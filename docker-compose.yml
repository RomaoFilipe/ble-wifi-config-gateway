version: "3.9"

services:
  # üåê Frontend est√°tico (por ex. p√°gina de configura√ß√£o BLE)
  web_ble_config:
    image: nginx:alpine
    container_name: web_ble_config
    volumes:
      - ./web_config:/usr/share/nginx/html:ro
    ports:
      - "8080:80"
    restart: always
    networks:
      - iot_net

  # üê∂ Watchdog para monitorizar/recuperar containers
  watchdog:
    build:
      context: ./watchdog
      dockerfile: Dockerfile
    container_name: gateway_iot_watchdog
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: always
    networks:
      - iot_net

  # ‚è±Ô∏è Worker de agendamentos de irriga√ß√£o (loop cont√≠nuo)
  cron_worker:
    build:
      context: .
      dockerfile: cron_worker/Dockerfile.cron
    container_name: cron_worker
    restart: unless-stopped
    env_file:
      - ./cron_worker/.env         # cria este ficheiro com RAILS_API_URL, API_TOKEN, DATABASE_URL, MQTT_BROKER, MQTT_PORT, TZ
    networks:
      - iot_net
    # Broker √© EXTERNO (ex.: 13.48.48.4) ‚Üí sem depends_on

networks:
  iot_net:
    driver: bridge
